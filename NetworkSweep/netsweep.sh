#
# Network Sweep
#
# Autor: Jose Luis Torres Rodriguez
# 
# Revisar las direcciones 1 a 254 del segmento de red recibido, mostrando la ip de los  
# equipos que se encuentran encendidos. Para verificar esto se hace uso de ping (paquetes de ICMP).
#
# Funcionamiento:
# Recibe como argumento la direccion IP de la red a revisar, verifica que se trate de una
# direccion IP v4 valida y hace un monitoreo de las direcciones del segmento correspondiente.
# Se debe considerar que solamente se muestran las direcciones de los equipos que responden a
# los paquetes enviados por ping.
#
#!/bin/bash

ayuda()
{
    echo "$0 recibe como argumento una direccion IP v4 y muestra los equipos de la red correspondiente que se encuentran encendidos."
    echo "Uso: $0 direccion-ip-v4"
    echo "Ejemplo: $0 192.168.1.0"
}

# El script recibe un argumento, si el numero de argumentos no corresponde
# mostramos la ayuda
if [ $# -ne 1 ]
then
    ayuda
    exit 1
fi

# Revisamos el argumento recibido, si no corresponde a una IP v4 mostramos un mensaje
# de error y la ayuda.
ip="$1"
if [[ ! $ip =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]
then
    echo "Error direccion invalida."
    ayuda
fi

# Separamos los primeros tres octetos
red=`echo $ip | awk -F "." '{print $1,".",$2,".",$3,"."}' | sed 's/\ //g'`

# Revisamos las direcciones del segmento y mostramos los equipos encendidos
echo "Revisando ..."
actual=1
while [ $actual -lt 255 ]
do
    # Establecemos tiempos de espera cortos para acelerar la ejecucion del script
    if ping -w 1 -W 0.4 -c 2 "$red$actual" >/dev/null 2>/dev/null
    then
	echo -e "$red$actual - \e[0;34mENCENDIDO\e[0m"
# Se pueden eliminar los comentarios a las siguientes dos lineas para mostrar tambien
# las direcciones de los equipos apagados.
#    else
#	echo -e "$red$actual - \e[1;31mAPAGADO\e[0m"
    fi
    let actual=actual+1
done
